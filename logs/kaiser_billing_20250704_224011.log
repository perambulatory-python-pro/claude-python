2025-07-04 22:40:12,235 - etl.kaiser_billing_processor - INFO - Starting KAISER billing period processing: 2025-05-30_to_2025-06-12
2025-07-04 22:40:12,236 - etl.kaiser_billing_processor - INFO - 
Processing region: N California
2025-07-04 22:40:12,294 - etl.kaiser_billing_processor - INFO - Loaded 8 KAISER sub-regions from database
2025-07-04 22:40:12,294 - etl.kaiser_billing_processor - INFO - Found region 'N California' with ID: 274
2025-07-04 22:40:13,566 - etl.tracktik_client - INFO - Successfully authenticated with TrackTik API
2025-07-04 22:40:13,972 - etl.tracktik_client - INFO - Fetching /rest/v1/clients: 1005 total records
2025-07-04 22:40:19,225 - etl.tracktik_client - INFO - Retrieved 1005 records from /rest/v1/clients
2025-07-04 22:40:19,226 - etl.kaiser_billing_processor - INFO - Found 188 clients in region N California
2025-07-04 22:40:19,226 - etl.kaiser_billing_processor - INFO - Loading dimensions for N California
2025-07-04 22:40:19,294 - etl.kaiser_billing_processor - ERROR - Failed to process region N California: column "valid_to" of relation "dim_regions" does not exist
LINE 3:                             SET valid_to = CURRENT_TIMESTAMP...
                                        ^

2025-07-04 22:40:19,294 - etl.kaiser_billing_processor - INFO - 
Processing region: S California
2025-07-04 22:40:19,294 - etl.kaiser_billing_processor - INFO - Found region 'S California' with ID: 275
2025-07-04 22:40:19,742 - etl.tracktik_client - INFO - Fetching /rest/v1/clients: 1005 total records
2025-07-04 22:40:24,141 - etl.tracktik_client - INFO - Retrieved 1005 records from /rest/v1/clients
2025-07-04 22:40:24,142 - etl.kaiser_billing_processor - INFO - Found 265 clients in region S California
2025-07-04 22:40:24,142 - etl.kaiser_billing_processor - INFO - Loading dimensions for S California
2025-07-04 22:40:24,210 - etl.kaiser_billing_processor - ERROR - Failed to process region S California: column "valid_to" of relation "dim_regions" does not exist
LINE 3:                             SET valid_to = CURRENT_TIMESTAMP...
                                        ^

2025-07-04 22:40:24,211 - etl.kaiser_billing_processor - INFO - 
Processing region: Hawaii
2025-07-04 22:40:24,211 - etl.kaiser_billing_processor - INFO - Found region 'Hawaii' with ID: 276
2025-07-04 22:40:24,653 - etl.tracktik_client - INFO - Fetching /rest/v1/clients: 1005 total records
2025-07-04 22:40:29,211 - etl.tracktik_client - INFO - Retrieved 1005 records from /rest/v1/clients
2025-07-04 22:40:29,211 - etl.kaiser_billing_processor - INFO - Found 60 clients in region Hawaii
2025-07-04 22:40:29,211 - etl.kaiser_billing_processor - INFO - Loading dimensions for Hawaii
2025-07-04 22:40:29,287 - etl.kaiser_billing_processor - ERROR - Failed to process region Hawaii: column "valid_to" of relation "dim_regions" does not exist
LINE 3:                             SET valid_to = CURRENT_TIMESTAMP...
                                        ^

2025-07-04 22:40:29,287 - etl.kaiser_billing_processor - INFO - 
Processing region: Washington
2025-07-04 22:40:29,287 - etl.kaiser_billing_processor - INFO - Found region 'Washington' with ID: 277
2025-07-04 22:40:29,672 - etl.tracktik_client - INFO - Fetching /rest/v1/clients: 1005 total records
2025-07-04 22:40:34,073 - etl.tracktik_client - INFO - Retrieved 1005 records from /rest/v1/clients
2025-07-04 22:40:34,074 - etl.kaiser_billing_processor - INFO - Found 68 clients in region Washington
2025-07-04 22:40:34,074 - etl.kaiser_billing_processor - INFO - Loading dimensions for Washington
2025-07-04 22:40:34,157 - etl.kaiser_billing_processor - ERROR - Failed to process region Washington: column "valid_to" of relation "dim_regions" does not exist
LINE 3:                             SET valid_to = CURRENT_TIMESTAMP...
                                        ^

2025-07-04 22:40:34,157 - etl.kaiser_billing_processor - INFO - 
Processing region: Colorado
2025-07-04 22:40:34,157 - etl.kaiser_billing_processor - INFO - Found region 'Colorado' with ID: 278
2025-07-04 22:40:34,589 - etl.tracktik_client - INFO - Fetching /rest/v1/clients: 1005 total records
2025-07-04 22:40:38,524 - etl.tracktik_client - INFO - Retrieved 1005 records from /rest/v1/clients
2025-07-04 22:40:38,524 - etl.kaiser_billing_processor - INFO - Found 84 clients in region Colorado
2025-07-04 22:40:38,525 - etl.kaiser_billing_processor - INFO - Loading dimensions for Colorado
2025-07-04 22:40:38,596 - etl.kaiser_billing_processor - ERROR - Failed to process region Colorado: column "valid_to" of relation "dim_regions" does not exist
LINE 3:                             SET valid_to = CURRENT_TIMESTAMP...
                                        ^

2025-07-04 22:40:38,597 - etl.kaiser_billing_processor - INFO - 
Processing region: Georgia
2025-07-04 22:40:38,597 - etl.kaiser_billing_processor - INFO - Found region 'Georgia' with ID: 279
2025-07-04 22:40:39,091 - etl.tracktik_client - INFO - Fetching /rest/v1/clients: 1005 total records
2025-07-04 22:40:44,212 - etl.tracktik_client - INFO - Retrieved 1005 records from /rest/v1/clients
2025-07-04 22:40:44,212 - etl.kaiser_billing_processor - INFO - Found 50 clients in region Georgia
2025-07-04 22:40:44,213 - etl.kaiser_billing_processor - INFO - Loading dimensions for Georgia
2025-07-04 22:40:44,285 - etl.kaiser_billing_processor - ERROR - Failed to process region Georgia: column "valid_to" of relation "dim_regions" does not exist
LINE 3:                             SET valid_to = CURRENT_TIMESTAMP...
                                        ^

2025-07-04 22:40:44,286 - etl.kaiser_billing_processor - INFO - 
Processing region: MidAtlantic
2025-07-04 22:40:44,286 - etl.kaiser_billing_processor - INFO - Found region 'MidAtlantic' with ID: 282
2025-07-04 22:40:44,726 - etl.tracktik_client - INFO - Fetching /rest/v1/clients: 1005 total records
2025-07-04 22:40:48,818 - etl.tracktik_client - INFO - Retrieved 1005 records from /rest/v1/clients
2025-07-04 22:40:48,819 - etl.kaiser_billing_processor - INFO - Found 150 clients in region MidAtlantic
2025-07-04 22:40:48,819 - etl.kaiser_billing_processor - INFO - Loading dimensions for MidAtlantic
2025-07-04 22:40:48,892 - etl.kaiser_billing_processor - ERROR - Failed to process region MidAtlantic: column "valid_to" of relation "dim_regions" does not exist
LINE 3:                             SET valid_to = CURRENT_TIMESTAMP...
                                        ^

2025-07-04 22:40:48,892 - etl.kaiser_billing_processor - INFO - 
Processing region: Northwest
2025-07-04 22:40:48,893 - etl.kaiser_billing_processor - INFO - Found region 'Northwest' with ID: 1029
2025-07-04 22:40:49,334 - etl.tracktik_client - INFO - Fetching /rest/v1/clients: 1005 total records
2025-07-04 22:40:53,748 - etl.tracktik_client - INFO - Retrieved 1005 records from /rest/v1/clients
2025-07-04 22:40:53,749 - etl.kaiser_billing_processor - INFO - Found 6 clients in region Northwest
2025-07-04 22:40:53,749 - etl.kaiser_billing_processor - INFO - Loading dimensions for Northwest
2025-07-04 22:40:53,819 - etl.kaiser_billing_processor - ERROR - Failed to process region Northwest: column "valid_to" of relation "dim_regions" does not exist
LINE 3:                             SET valid_to = CURRENT_TIMESTAMP...
                                        ^

2025-07-04 22:40:53,874 - root - ERROR - Fatal error in processing
Traceback (most recent call last):
  File "c:\Users\brend\Finance Ops Dropbox\Brendon Jewell\coding\claude-python\tracktik_etl\run_kaiser_billing_period.py", line 50, in main
    stats = processor.process_billing_period(START_DATE, END_DATE)
  File "c:\Users\brend\Finance Ops Dropbox\Brendon Jewell\coding\claude-python\tracktik_etl\etl\kaiser_billing_processor.py", line 126, in process_billing_period
    self._log_etl_run(overall_stats)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "c:\Users\brend\Finance Ops Dropbox\Brendon Jewell\coding\claude-python\tracktik_etl\etl\kaiser_billing_processor.py", line 454, in _log_etl_run
    ETLRunLog.log_run(stats)
    ~~~~~~~~~~~~~~~~~^^^^^^^
  File "c:\Users\brend\Finance Ops Dropbox\Brendon Jewell\coding\claude-python\tracktik_etl\etl\models.py", line 223, in log_run
    db.execute_query(query, log_data)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "c:\Users\brend\Finance Ops Dropbox\Brendon Jewell\coding\claude-python\tracktik_etl\etl\database.py", line 56, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\brend\Finance Ops Dropbox\Brendon Jewell\coding\claude-python\.venv\Lib\site-packages\psycopg2\extras.py", line 236, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "table_name" of relation "etl_sync_status" violates not-null constraint
DETAIL:  Failing row contains (null, 2025-07-04 22:40:53.819911+00, null, null, kaiser_billing_2025-05-30_to_2025-06-12, error, 0, Failed to process region N California: column "valid_to" of rela...).

